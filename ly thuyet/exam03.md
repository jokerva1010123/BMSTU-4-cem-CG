# 03. Построение плоских кривых. Выбор шага изменения аргумента. Алгоритм построения эллипса и окружности по методу средней точки.

Окружность можно описать:

```
(x - x0)^2 + (y - y0)^2 = R^2
x^2 + y^2 = R^2
y = sqrt(R^2 - x^2)
```

Параметрически:

```
x = x0 + R*cost
y = y0 + R*sint
```

t ∈ [0, 2pi)

Можно построить и окружность, и эллипс используя эти уравнения. При этом, шаг изменения аргумента ```t = 1 / R```. (**можно добавить вывод 1 / R, но мне лень**).

При генерации окружности достаточно построить 1/8 окружность (от ```(0, R)``` по часовой стрелке) и отразить получившеюся дугу.  
При генерации эллипса так не получится, придется строить 1/4 окружности.

# Алгоритм построения по методу средней точки

Уравнение эллипса можно записать в виде:

```
b^2 x^2 + a^2 y^2 - a^2 b^2 = 0
```

Название **средней точки** связано с тем, что на каждом этапе выбора пикселя, анализируется средняя точка между двумя пикселями. Определяется, находится точка внутри или вне эллипса, и взависимости от этого делается выбор пикселя. 

**Пробная функция** - функция вида f(x, y). Равна 0, если точка принадлежит описываемой фигуре. В данном случае в качестве пробной функции возьмем уравнение (эллипса), указанное выше.

* f(x, y) < 0 - точка внутри эллипса.
* f(x, y) > 0 - точка вне эллипса.

На основе этого, выбирается ближайший к эллипсу пиксель.  
**Какие пары будем анализировать**, зависит от угла наклона касательной к эллипсу. 

* Пока dy/dx > -1 выбор идет между двумя вертикальными пикселями.
* Пока dy/dx < -1 выбор идет между двумя горизонтальными пикселями.

![pppp](https://camo.githubusercontent.com/18fcc164be30a459d4161c8014e307e766e96d67/68747470733a2f2f73756e312d39322e757365726170692e636f6d2f4a4a44666a656267396a38327845644a2d68666643736a6a7644686d58776a7a6e526e7a66412f72426447593836306d67412e6a7067)

**Первый интервал**  
![fst](https://camo.githubusercontent.com/aa0c691903ebab238138f46b978f16f4a0d9356b/68747470733a2f2f73756e312d32372e757365726170692e636f6d2f71756a74367443564f34465239473976534571717a44725f394c394132325f6641676c3951412f6f3059336976764c6152452e6a7067)

Значение пробной функции для средней точки:  
![sdd](https://camo.githubusercontent.com/d95f68727e81b1fc6c0bb8afb97ee4adf4dd9794/68747470733a2f2f73756e312d39362e757365726170692e636f6d2f49447a75323672625a696c4d33673131497865647a3858786b55646c6f39564c4b3054656d772f47736676546c4d533059732e6a7067)

Полученое значение требует затратных вычислений, поэтому можно свести его получение к рекурентному процессу. Координаты предыдущей средней точки: ```(Xi-1, Yi–1 + 0,5)```.

![ерa](https://camo.githubusercontent.com/f9be3e1c662b5b17729402b7f41cd84d22b494c0/68747470733a2f2f73756e312d39332e757365726170692e636f6d2f6d447756497a5231453875352d774354704b344148697352744a6d30516b6147466d384261512f37564561554478344e61412e6a7067)  
![d](https://camo.githubusercontent.com/710333291b09994e9a200bc40e65fbf0b4c539a4/68747470733a2f2f73756e312d38372e757365726170692e636f6d2f42485a6b78734f424a3667496c68744765644263726d6a55584e565477786f4266744e424c512f316768416b6a4b753961732e6a7067)

**Второй интервал**
![2](https://camo.githubusercontent.com/0f3e7c4ae86647ce17214ff1577c4f645382a9f6/68747470733a2f2f73756e312d32332e757365726170692e636f6d2f4a55544f7a733137366958694e62445152615850487659366e396e66376b45703567534339772f767039586f6d534b5132672e6a7067)

* Если М расположена вне эллипса, то А расположена ближе к эллипсу.
* Если М расположена внутри эллипса, то В расположена ближе к эллипсу.

![3](https://camo.githubusercontent.com/9f19038f56a0ac544173437fd570e8feeadda163/68747470733a2f2f73756e312d34372e757365726170692e636f6d2f4239714b6c416455334231386f3967587867305f4c333878657851557562466a7a4f624562672f6d7848695477376f72416b2e6a7067)  
![4](https://camo.githubusercontent.com/63aef78e69d4ee9bdcc21fbc5defb66c09379bfd/68747470733a2f2f73756e312d38382e757365726170692e636f6d2f576f5f4b547a4a4866396a6456384566484b6f48467a4939566963725f426855622d467857412f66796f6d5f375274755f382e6a7067)

# Переход от первого случая ко второму

Переход происходит, когда dy/dx = -1. Продифференцировав ```b^2 x^2 + a^2 y^2 - a^2 b^2```, получим:  

![5](https://camo.githubusercontent.com/238991a914b866dc10c27585cccfc14517f848ff/68747470733a2f2f73756e312d38392e757365726170692e636f6d2f5151634b4c3135327742594879354931564959615a444e6b4272516461696a414a6b386a63672f34343533786e34397174732e6a7067)  
использовать для определения точки, в которой выполняется равенство dy/dx = -1.

**Получение пробной функции для граничного случая**

![6](https://camo.githubusercontent.com/0cc065a1f3e2835709b3291525005000c6783af4/68747470733a2f2f73756e312d39362e757365726170692e636f6d2f4f45514845304b66485f78574f7466714d7a37516f35776138726b694537366a56414d6b35412f7834504f344f4d677341342e6a7067)  
![7](https://camo.githubusercontent.com/c3c7c753c29aad6b32c704007606baf3af422667/68747470733a2f2f73756e312d31372e757365726170692e636f6d2f6d344c4446544462544b6b51677073437474364a643345554b4263455449345a594d373279772f39455a7448716c33536f592e6a7067)

# Вычисление пробной функции для начальной точки

![8](https://camo.githubusercontent.com/6f43fac298d801ca6dc672c71c9ab565513400db/68747470733a2f2f73756e312d39322e757365726170692e636f6d2f35634457336a336452725a38526b7246587a473662414558754432647857644f6a344f674e772f32455f70517072675362552e6a7067)

## Псевдокод

```
Вход: a, b, xc, yc

b2 = b * b
bd = 2 * b2
a2 = a * a
ad = 2 * a2

x = 0, y = b, f = b2 - a2 * b + 0,25 * a2

while b2 * x > a2 * y do
    if f > 0 then
        x = x + 1
        y = y - 1
        f = f + bd * x + b2 - ad * y
    else
        x = x + 1
        f = f + bd * x + b2

f = f + 3 / 4 * (a2 + b2) - (a2 * y + b2 * x)

while y >= 0 do
    if f > 0 then
        y = y - 1
        x = x + 1
        f = f + ad * y + a2 - bd * x
    else
        y = y - 1
        f = f + ad * y + a2


```


**Следующий вопрос:**  [04. Требования, предъявляемые к алгоритмам вычерчивания отрезков.  Пошаговый  алгоритм разложения  отрезка в растр.  Разложение в  растр по методу цифрового дифференциального анализатора.](./exam04)


**Предыдущий вопрос:**  [02. Преобразования на плоскости. Вывод расчетных соотношений.  Матрицы преобразований.](./exam02)
