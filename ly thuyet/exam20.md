# 20. Операции преобразования в трехмерном пространстве. Матрицы преобразований.

Матрица преобразований в 3х-мерном пространстве будет иметь рамзерность 4х4. Координаты точек ```(x, y, z)``` заменятся четверкой ```(wx, wy, wz, w), w != 0.```

**Аффинное преобразование** (вики) - отображение плоскости или пространства в себя, при котором параллельные прямые переходят в параллельные прямые, пересекающиеся — в пересекающиеся, скрещивающиеся — в скрещивающиеся, а также существует обратное преобразование. 

**Афиинное преобразование** (по Курову) - плоскость не вырождается в прямую или в точку, сохраняется параллельность прямых и существует обратное преобразование.

Любое аффинное преобразование в трехмерном пространстве может быть представлено в виде суперпозиции переносов, масштабирований, поворотов.

## Перенос

Матрица преобразований:  
![1](https://camo.githubusercontent.com/f0e7d3099ce9c5d801462c1e471a2a31f7086723/68747470733a2f2f692e696d6775722e636f6d2f4b4a594b48354c2e706e67)  

Формулы:  
```
x' = x + dx
y' = y + dy
z' = z + dz
```

**Положительные значения** dz приводят к удалению точки от наблюдателя в глубь экрана, **при отрицательных** - точка приближается к наблюдателю.

## Масштабирование

Матрица преобразований:  
![2](https://camo.githubusercontent.com/f90de4d0d4f12dee2f7e879a44b9a38e548f73e2/68747470733a2f2f692e696d6775722e636f6d2f724b45394e6f352e706e67)

Формулы:
```
x' = x * kx + (1 - kz) * x
y' = y * ky + (1 - ky) * y
z' = z * kz + (1 - kz) * z
```

**При использовании матрицы**, сначала нужно перенести тело и центр масштабирования так, чтобы центр масштабирования оказался в начале координат.

* При KX = -1, KY = 1, KZ = 1 происходит отображение относительно плоскости YOZ (или ей параллельной); 
* При KX = 1, KY = -1, KZ = 1 происходит отображение относительно плоскости XOZ (или ей параллельной);
* При KX = 1, KY = 1, KZ = -1 происходит отображение относительно плоскости XOY. 
* При отрицательных значениях коэффициентов масштабирования происходит симметричное отображение масштабируемого объекта относительно соответствующей координатной плоскости.

## Поворот. 

Матрица преобразований (вокруг OZ):

![3](https://camo.githubusercontent.com/878ec4a0df5185db39371d574549912841d38297/68747470733a2f2f692e696d6775722e636f6d2f42376473436b6c2e706e67)

Формулы:  
```
x' = xc + (x - xc) * cosθ - (y - yc) * sinθ
y' = yc + (x - xc) * sinθ + (y - yc) * cosθ
```

Матрица преобразований (вокург OX):

![4](https://camo.githubusercontent.com/87dfb7a376368d8c718d02a72d2d4c9ed2fb8edb/68747470733a2f2f692e696d6775722e636f6d2f586639554f6d332e706e67)

Формулы:
```
y' = yc + (y - yc) * cosθ - (z - zc) * sinθ
z' = zc + (z - zc) * cosθ + (y - yc) * sinθ
```

Матрица преобразований (вокруг OY):

![5](https://camo.githubusercontent.com/c1f35fa5c6d94cc4ed7bd714e4920c533b59106f/68747470733a2f2f692e696d6775722e636f6d2f476f376a4549642e706e67)

Формулы:
```
x' = xc + (x - xc) * cosθ + (z - zc) * sinθ
z' = zc + (z - zc) * cosθ - (x - xc) * sinθ
```

## Перспективное проецирование на плоскость z = 0.

**Перспективное преобразование** — это преобразование одного трехмерного пространства в другое. 

* Весь правый столбец отвечает за проецирование на разные плоскости, если бы мы хотели получить проекцию на ось Х, то -1/C было бы в первой строке последнего столбца. 
* Проекция на одну плоскость - одноточечное проецирование, но можно совмещать и получать двухточечные проекции и тд. 

Матрица преобразований:  
![6](https://camo.githubusercontent.com/899c94627196be3fdeaf75dd92730bbc0b781a7e/68747470733a2f2f692e696d6775722e636f6d2f733634743178322e706e67)

```С - фокусное расстояние на оси Z```

## Про [коммутативность.](./exam02)

**Предыдущий вопрос:**  [19. Модели трехмерных объектов. Требования, предъявляемые к моделям.](./exam19)

**Следующий вопрос:**  [21. Трехмерное отсечение. Виды отсекателей. Вычисление кодов  концов отрезка для каждого типа отсекателей. Алгоритм отсечения  отрезков средней точкой.](./exam21)
