# 21.Трехмерное отсечение. Виды отсекателей. Вычисление кодов  концов отрезка для каждого типа отсекателей. Алгоритм отсечения  отрезков средней точкой.

**Отсечение** - операция удаления части изображения, находящейся за пределами некоторой заданной области, называемой отсекателем.

## Трехмерное отсечение

В трехмерном отсечении, **чаще всего** (но не всегда), отсекателем является прямоугольный параллепипед или усеченая пирамида (шесть граней)

## Паралелепипед 


Тут как и в двумерном отсечении, используются коды концевых точек. В трехмерном случае, используется 6-битовый код.

**первый бит**    - если конец ребра левее объема  (x < xл)  
**второй бит**    - если конец ребра правее объема  (x > хп)  
**третий бит**    - если конец ребра ниже объема  (y < yн)  
**четвертый бит** - если конец ребра выше объема  (y > yв)  
**пятый бит**     - если конец ребра ближе объема  (z > zб)  
**шестой бит**    - если конец ребра дальше объема  (z < zn)  

![1](https://camo.githubusercontent.com/b53cc1843482bb19ad6e2e34e0c648842324e317/68747470733a2f2f73756e312d39382e757365726170692e636f6d2f2d6478724e694973594c4b66452d61474c4c4670653948486b3745416370694f797a464530412f32435242667a6446544e412e6a7067)

## Усечёная пирамида

В случае усечённой пирамиды, обычно используют пробные функции (для каждой грани, итого 6), которые составляют код.

**Пробная функция** (определение сделано на основе слов Курова) - это такая функция, которая позволяет определить, как расположена точка относительно плоскости (в случае 3дэ). То есть надо точку подставить в эту функцию. Если fпр = 0, то точка лежит на плоскости. 

**ЧТОБЫ ПРАВИЛЬНО СУДИТЬ, КАК РАСПОЛОЖЕНА ТОЧКА (ПО КАКУЮ СТОРОНУ ОТ ПЛОСКОСТИ), НАДО ЗНАК ПРОБНОЙ ФУНКЦИИ ДЛЯ ЭТОЙ ТОЧКИ СРАВНИТЬ СО ЗНАКОМ ПРОБНОЙ ФУНКЦИИ ДЛЯ ТОЧКИ, ПОЛОЖЕНИЕ КОТОРОЙ НАМ ИЗВЕСТНО** (c) Куров, 1488 год до н.э.

![2](https://camo.githubusercontent.com/4d4977beb525cd22aeba6cb1738d3fa280e436e5/68747470733a2f2f73756e312d39352e757365726170692e636f6d2f6a4c6a5961505a7944792d6a426b7578474c5a564f4a70444c436931314763495272672d33772f66725a6c532d30537231552e6a7067)

**zцп** - центр проекции.

Уравнение прямой на плоскости xz, несущей проекцию правой грани отсекателя, имеет вид:  
![3](https://camo.githubusercontent.com/8043203687892a0d178f7ac059b7241d11fc21c0/68747470733a2f2f73756e312d39392e757365726170692e636f6d2f575946314c2d4648575f4568486d415a69326e516c5a666357317063554979643071435241512f424c5a734563425531364d2e6a7067)

Пробная функция для fп (правая грань):

![fp](https://camo.githubusercontent.com/be6ba9808c7cc65dc9d3c2e129c0b672f6ef86e5/68747470733a2f2f73756e312d31342e757365726170692e636f6d2f67673543565a49526270367a504d37374a6d4358706b4368595030434a6559797757326e45772f4833536f536772615f31512e6a7067)

И т. д:

![ep](https://camo.githubusercontent.com/798f3a6088f0ad8ac46127b344b8bb878b2d6715/68747470733a2f2f73756e312d39322e757365726170692e636f6d2f6a7a524145674650364873793447386c4f7952396845584a4b59616a5836646f4c39504265412f75626b4854584f727a384d2e6a7067)

Чем ближе zцп к бесконечности, тем больше фигура приближается к прямоугольному параллепипеду. Пробные функции при этом тоже приближаются к соответствующим пробным функциям прямоугольного парллелепипеда.

Тут ещё есть свой прикол: последний метод на скрине (для ближней и дальней грани), может выдать неправильные значения кодов, если концы отрезка лежат за центром проекции.  
**Решение:** если z > zцп, проверять только первые четыре бита кода.  

# Про коды

* Сумма битов кодов = 0 - отрезок видим, как и в двумерном случае
* Одна сумма = 0, другая != 0 - отрезок частично видим. 
* В остальных случаях используем логическое произведение кодов: T1[0] * T2[0] + ... + T1[5] * T2[5]. Если ЛП != 0, то отрезок полностью невидимый.

Можно сделать вывод, что тут все так же, как и в двумерном случае.

## Трехмерный алгоритм разбиения средней точкой

Тут все абсолютно так же, как и [в двухмерном случае](./exam14). Нужно изменить количество битов в коде конца отрезка.

**Следующий вопрос:**  [22. Отсечение отрезков в трехмерном пространстве. Трехмерный алгоритм Кируса Бека.](./exam22)


**Предыдущий вопрос:**  [20. Операции преобразования в трехмерном пространстве. Матрицы преобразований.](./exam20)
